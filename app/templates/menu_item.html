{% extends 'base.html' %}
{% load static %}
{% block content %}
<section>
    <article>
        <h1>Menu item</h1>
        <span>
            <a href="{% url 'home' %}">Home</a> /
            <a href="{% url 'menu' %}">Menu</a>/
            {{menu_item.name}}
        </span>
        <!--Begin row-->
        <div class="row">
            <!--Begin col-->
            <div class="column">
                <h2>
                    {{ menu_item.name }} - <i class="fa fa-star small_star"></i>
                </h2>
                <p>
                    {{ menu_item.menu_item_description }}
                </p>
                <p>
                    Price: ${{ menu_item.price }}.00
                </p>
                <form id="ratingForm" class="row">
                    <label>
                        <input type="radio" name="star" value="1"><i class="fa fa-star fa-3x"></i>
                    </label>
                    <label>
                        <input type="radio" name="star" value="2"><i class="fa fa-star fa-3x"></i>
                    </label>
                    <label>
                        <input type="radio" name="star" value="3"><i class="fa fa-star fa-3x"></i>
                    </label>
                    <label>
                        <input type="radio" name="star" value="4"><i class="fa fa-star fa-3x"></i>
                    </label>
                    <label>
                        <input type="radio" name="star" value="5"><i class="fa fa-star fa-3x"></i>
                    </label>

                    <button type="button" id="submitRating">Submit</button>
                </form>
            </div>
            <!--End col-->
            <!--Begin col-->
            <div class="column">
                <img src="{% static 'img/' %}{{ menu_item.name }}.jpg" alt="{{ menu_item.name }}" />
            </div>
            <!--End col-->
        </div>
        <!--End row-->
    </article>
</section>

<script>
    const stars = document.querySelectorAll("label i");
let selectedRating = 0;

stars.forEach((star, index) => {
    star.addEventListener("click", () => {
        const radio = star.previousElementSibling;
        radio.checked = true;
        selectedRating = radio.value;

        // Remove selected class from all stars
        stars.forEach((s) => s.classList.remove("selected"));
        stars.forEach((s) => s.classList.add("unselected"));

        // Add selected class to clicked star and all previous stars
        for (let i = 0; i <= index; i++) {
            stars[i].classList.add("selected");
            stars[i].classList.remove("unselected");
        }

        console.log(`Star ${index + 1} selected`);
        console.log(`Rating: ${selectedRating}`);
    });
});

document.getElementById("submitRating").addEventListener("click", () => {
    if (selectedRating > 0) {
        fetch("/test", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ rating: selectedRating }),
        })
            .then((response) => response.json())
            .then((data) => {
                console.log("Success:", data);
            })
            .catch((error) => {
                console.error("Error:", error);
            });
    } else {
        alert("Please select a rating");
    }
});

</script>
{% endblock %}